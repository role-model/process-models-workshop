# ML parameter estimation with MESS simulations

## Key questions

1. How do I estimate parameter values for continuous MESS model parameters?
1. How do I evaluate the uncertainty of ML parameter estimates?

## Lesson objectives

After this lesson, learners should be able to...

1. Use simulations and randomForest ML to perform parameter estimation for
key MESS model parameters.
1. Evaluate uncertainty in parameter estimation accuracy using cross-validation
simulations.
1. Apply ML parameter estimation to empirical data and interpret results in
terms of story
1. Brainstorm applications to real data

## Planned exercises

* Motivating MESS process-model parameter estimation
* Implement ML parameter estimation
* Hands-on Exercise: Predicting MESS parameters of mystery simulations
* Posterior predictive simulations (if time)

### Motivating MESS process-model parameter estimation

Now that we have identified the neutral model as the most probable, we can
estimate parameters of the emipirical data given this model. Essentially,
we are asking the question "What are the parameters of the model that
generate summary statistics most similar to those of the empirical data?"

### Implement ML parameter estimation

#### Load libraries, setwd, and load the simulated data
```R
library(randomForest)
library(caret)
library(reticulate)

setwd("/home/rstudio/MESS-inference")
simdata = MESS$load_local_sims("MESS-SIMOUT.csv")[[1]]
```

#### Extract sumulations generated under the 'filtering' assembly model
```R
simdata = simdata[simdata$assembly_model == "filtering", ]
simdata
```

#### Split train and test data as normal
```R
tmp <- sample(2, nrow(simdata), replace = TRUE, prob = c(0.7, 0.3))
train <- simdata[tmp==1,]
test <- simdata[tmp==2,]
```

#### Train the ML regressor as normal
```R
rf <- randomForest(colrate ~ local_S + pi_h1 + abund_h1 + trait_h1, data=train, proximity=TRUE)
rf
```

#### Plot results of predictions for colrate of held-out training set
```R
preds <- predict(rf, test)
plot(preds, test$colrate)
```

#### Predict `colrate` of test simulation and plot distribution of predictions
```R
preds <- predict(rf, test[5, ], predict.all=TRUE)
hist(preds[[2]])
```

### Hands-on Exercise: Predicting MESS parameters of mystery simulations

### Posterior predictive simulations (if time)

## Key points
* wat
* do
* bee
